{% extends "base.html" %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body, .bg-dark-custom { background: #181f2a !important; }
  .users-header { color: #fff; font-size: 2.2rem; font-weight: bold; margin-bottom: 2rem; }
  .table-users th, .table-users td { vertical-align: middle; }
  .badge-role-employee { background: #2563eb; }
  .badge-role-super_admin { background: #16a34a; }
  .badge-role-admin { background: #ea580c; }
  .badge-role { color: #fff; font-size: 0.95em; font-weight: 500; border-radius: 8px; padding: 6px 14px; }
  .btn-new-user { background: #2563eb; color: #fff; font-weight: 600; border-radius: 8px; }
  .btn-new-user:hover { background: #1d4ed8; color: #fff; }
  .table-dark th, .table-dark td { color: #fff; }
  .table-dark { background: #232b3e; }
  .search-bar { background: #232b3e; border: none; color: #fff; border-radius: 8px; }
  .search-bar:focus { background: #232b3e; color: #fff; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid bg-dark-custom min-vh-100">
  <div class="row">
    <main class="col-12 px-md-5 py-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <div class="text-uppercase text-secondary small mb-1">Users &nbsp; / &nbsp; List</div>
          <div class="users-header">Users</div>
        </div>
        <a href="{{ url_for('register') }}" class="btn btn-new-user">New user</a>
      </div>
      <div class="card shadow-sm table-responsive">
        <form method="get" class="p-3 d-flex justify-content-between align-items-center">
          <input type="text" name="q" value="{{ q }}" class="form-control search-bar w-25" placeholder="Search">
          <input type="hidden" name="per_page" value="{{ per_page }}">
          <button type="submit" class="btn btn-primary ms-2">Rechercher</button>
        </form>
        <table class="table table-dark table-users align-middle mb-0">
          <thead>
            <tr>
              <th scope="col"><input type="checkbox"></th>
              <th scope="col">Profile</th>
              <th scope="col">Name</th>
              <th scope="col">Email</th>
              <th scope="col">Téléphone</th>
              <th scope="col">Sexe</th>
              <th scope="col">Role</th>
              <th scope="col">Adresse</th>
              <th scope="col">Poste</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr>
              <td><input type="checkbox"></td>
              <td class="text-center">
                <img src="{{ user.profile_url or url_for('static', filename='logo-wise.png') }}" alt="Profile" width="32" height="32" class="rounded-circle mx-auto d-block">
              </td>
              <td>{{ user.name or user.email.split('@')[0] }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.phone or '' }}</td>
              <td>{{ user.gender or '' }}</td>
              <td>
                <span class="badge badge-role badge-role-{{ user.role|lower|replace(' ', '_') }}">{{ user.role }}</span>
              </td>
              <td>{{ user.address or '' }}</td>
              <td>{{ user.position or '' }}</td>
              <td>
                <a href="#" class="btn btn-sm btn-outline-primary"><i class="fas fa-edit"></i></a>
                <a href="#" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {% else %}
            <tr><td colspan="10" class="text-center text-secondary">Aucun utilisateur trouvé.</td></tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="p-3 d-flex justify-content-between align-items-center">
          <div>Per page
            <form method="get" class="d-inline">
              <input type="hidden" name="q" value="{{ q }}">
              <select class="form-select d-inline w-auto ms-2" name="per_page" onchange="this.form.submit()">
                <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
              </select>
            </form>
          </div>
          <nav>
            <ul class="pagination mb-0">
              <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('users', q=q, page=pagination.prev_num, per_page=per_page) }}">Previous</a>
              </li>
              {% for p in range(1, pagination.pages+1) %}
              <li class="page-item {% if pagination.page == p %}active{% endif %}">
                <a class="page-link" href="{{ url_for('users', q=q, page=p, per_page=per_page) }}">{{ p }}</a>
              </li>
              {% endfor %}
              <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('users', q=q, page=pagination.next_num, per_page=per_page) }}">Next</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </main>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
{% endblock %}
