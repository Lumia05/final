{% extends "base.html" %}

{% block head %}
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body, .bg-dark-custom { background: #181f2a !important; }
  .sidebar-dark { background: #232b3e; min-height: 100vh; }
  .sidebar-dark .nav-link, .sidebar-dark .navbar-brand { color: #b0b8c1; }
  .sidebar-dark .nav-link.active, .sidebar-dark .nav-link:hover { color: #fff; background: #1a2233; }
  .dashboard-header { color: #fff; font-size: 2.2rem; font-weight: bold; margin-bottom: 2rem; }
  .card-metric { border: none; border-radius: 12px; color: #fff; }
  .card-metric.blue { background: #2563eb; }
  .card-metric.orange { background: #ea580c; }
  .card-metric.green { background: #16a34a; }
  .card-metric.red { background: #dc2626; }
  .card-metric.purple { background: #7c3aed; }
  .card-metric .icon { font-size: 2.2rem; opacity: 0.7; }
  .card-metric .metric-label { font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; }
  .card-metric .metric-value { font-size: 2.1rem; font-weight: bold; }
  .dashboard-content { margin-top: 2rem; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid bg-dark-custom">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-2 d-none d-md-block sidebar-dark sidebar">
      <div class="position-sticky pt-4">
        <ul class="nav flex-column">
          <li class="nav-item"><a class="nav-link active" href="{{ url_for('dashboard') }}"><i class="fas fa-tachometer-alt me-2"></i> Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('incidents') }}"><i class="fas fa-exclamation-circle me-2"></i> Incidents</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('problems') }}"><i class="fas fa-bug me-2"></i> Problèmes</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('knowledge') }}"><i class="fas fa-book me-2"></i> Base de connaissances</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('users') }}"><i class="fas fa-cog me-2"></i> Users</a></li>
        </ul>
      </div>
    </nav>
    <!-- Main content -->
    <main class="col-md-10 ms-sm-auto px-md-5 py-4">
      <div class="dashboard-header">TABLEAU DE BORD</div>
      <div class="row g-4 mb-4">
        <div class="col-md-4">
          <div class="card card-metric blue shadow-sm p-3">
            <div class="d-flex align-items-center">
              <div class="icon me-3"><i class="fas fa-exclamation-circle"></i></div>
              <div>
                <div class="metric-label">INCIDENTS</div>
                <div class="metric-value">{{ total_incidents }}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card card-metric orange shadow-sm p-3">
            <div class="d-flex align-items-center">
              <div class="icon me-3"><i class="fas fa-bug"></i></div>
              <div>
                <div class="metric-label">PROBLÈMES</div>
                <div class="metric-value">{{ total_problems }}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card card-metric purple shadow-sm p-3">
            <div class="d-flex align-items-center">
              <div class="icon me-3"><i class="fas fa-book"></i></div>
              <div>
                <div class="metric-label">BASE DE CONNAISSANCE</div>
                <div class="metric-value">{{ total_articles }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="dashboard-content">
        <div class="row">
          <div class="col-md-6 mb-4">
            <div class="card bg-dark text-white h-100">
              <div class="card-body">
                <h5 class="card-title">Top 5 Incidents</h5>
                <canvas id="chartIncidents"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-4">
            <div class="card bg-dark text-white h-100">
              <div class="card-body">
                <h5 class="card-title">Problèmes & Résolutions</h5>
                <canvas id="chartProblems"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- Font Awesome -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Exemple de données pour les graphiques
const ctx1 = document.getElementById('chartIncidents').getContext('2d');
new Chart(ctx1, {
  type: 'bar',
  data: {
    labels: ['Incident 1', 'Incident 2', 'Incident 3', 'Incident 4', 'Incident 5'],
    datasets: [{
      label: 'Incidents',
      data: [9, 7, 5, 3, 2],
      backgroundColor: '#2563eb'
    }]
  },
  options: { plugins: { legend: { display: false } } }
});
const ctx2 = document.getElementById('chartProblems').getContext('2d');
new Chart(ctx2, {
  type: 'line',
  data: {
    labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin'],
    datasets: [
      { label: 'Problèmes', data: [2, 3, 1, 4, 2, 1], borderColor: '#ea580c', backgroundColor: 'rgba(234,88,12,0.2)', fill: true },
      { label: 'Résolutions', data: [1, 2, 2, 3, 2, 2], borderColor: '#16a34a', backgroundColor: 'rgba(22,163,74,0.2)', fill: true }
    ]
  },
  options: { plugins: { legend: { labels: { color: '#fff' } } }, scales: { x: { ticks: { color: '#fff' } }, y: { ticks: { color: '#fff' } } } }
});
</script>
{% endblock %}